---
title: "VOLCANO_PLOT_CODE_WT_NT_VS_KO_NT"
author: "David Martínez Delgado"
date: "2025-07-31"
output: html_document
---
```{r}

#####################
# 0. Load Libraries #
#####################

library(tidyverse)

########################################
# 1. Daltonic-safe palette (Okabe-Ito) #
########################################

cb_palette <- c(
  "NS"   = "#999999",  # grey       → No change
  "UP"   = "#E69F00",  # orange     → Up
  "DOWN" = "#0072B2"   # sky-blue   → Down
)

########################################
# 2. Custom theme (Arial, full border) #
########################################

biostatsquid_theme <- function() {
  theme_classic(base_size = 14, base_family = "Arial") +
    theme(
      axis.title.x = element_text(face = "bold", margin = margin(t = 20)),
      axis.title.y = element_text(face = "bold", margin = margin(r = 20)),
      plot.title   = element_text(face = "bold", hjust = 0.5),
      legend.title = element_blank(),
      legend.key   = element_blank(),
      panel.border = element_rect(fill = NA, colour = "black", linewidth = 0.8)
    )
}

############################
# 3. Volcano-plot function #
############################

MyVolcanoPlt <- function(df,
                         log2FC_col,
                         padj_col,
                         Expression_col,
                         colours,
                         title_plot = "") {

  p <- ggplot(
      df,
      aes(
        x   = !!sym(log2FC_col),
        y   = -log10(!!sym(padj_col)),
        col = !!sym(Expression_col)
      )
    ) +
    geom_point() +

    # Colour-blind palette:
    
    scale_color_manual(
      values = colours,
      breaks = c("NS", "UP", "DOWN"),
      labels = c("No change", "Up", "Down"),
      name   = NULL
    ) +

    # Thresholds:
    
    geom_vline(xintercept = c(-0.58, 0.58),
               colour     = "grey50",
               linetype   = "dashed") +
    geom_hline(yintercept = -log10(0.05),
               colour     = "grey50",
               linetype   = "dashed") +

    # Axes limits & ticks (no extra expansion):
    
    scale_x_continuous(
      limits = c(-4, 4),
      breaks = seq(-4, 4, by = 1),
      expand = c(0, 0)
    ) +
    scale_y_continuous(
      limits = c(0, 18),
      breaks = seq(0, 18, by = 2),
      expand = c(0, 0)
    ) +

    # Labels:
    
    labs(
      x     = "log2FC",
      y     = expression("-log"[10]*"(p-adj value)"),
      title = title_plot
    ) +

    # Legend point size:
    
    guides(colour = guide_legend(override.aes = list(size = 4))) +

    # square plot region: ratio = Δx / Δy = 8 / 18 ≈ 0.444
    coord_fixed(ratio = 8 / 18) +

    biostatsquid_theme()

  return(p)
}

###########################################
# 4. Data import & processing (unchanged) #
###########################################

volcano_df <- read_tsv("TO_VOLCANO_FROM_WT_NT_VS_KO_NT.txt",
                       col_types = cols(
                         gene_symbol = col_character(),
                         pval        = col_double(),
                         padj        = col_double(),
                         log2fc      = col_double()
                       ))

volcano_df <- volcano_df %>%
  mutate(Expression = case_when(
           padj <= 0.05 &  log2fc >  0.58 ~ "UP",
           padj <= 0.05 &  log2fc < -0.58 ~ "DOWN",
           TRUE                           ~ "NS"
         ),
         Expression = factor(Expression,
                             levels = c("NS", "UP", "DOWN")))

####################
# 5. Plot creation #
####################

p <- MyVolcanoPlt(
       df             = volcano_df,
       log2FC_col     = "log2fc",
       padj_col       = "padj",
       Expression_col = "Expression",
       colours        = cb_palette,
       title_plot     = "WT No Treated vs KO No Treated"
     )

#######################################
# 6. Export: high-quality PNG and SVG #
#######################################

ggsave(
  filename = "VOLCANO_WT_NT_vs_KO_NT_FDR_0_05_FC_1.png",
  plot     = p,
  device   = "png",
  width    = 10,
  height   = 10,    # square file
  units    = "in",
  dpi      = 1200
)

ggsave(
  filename = "VOLCANO_WT_NT_vs_KO_NT_FDR_0_05_FC_1.svg",
  plot     = p,
  device   = "svg",
  width    = 10,
  height   = 10,
  units    = "in"
)


```

